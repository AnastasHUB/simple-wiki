<% title = 'Accueil'; %>
<h1>Derniers articles (≤ 7 jours)</h1>
<div class="article-grid">
  <% if (recent.length === 0) { %><div class="card">Aucun article récent.</div><% } %>
  <% recent.forEach(p => { const tags = (p.tagsCsv||'').split(',').filter(Boolean); %>
    <div class="card">
      <h3><strong><%= p.title %></strong></h3>
      <% if (p.excerpt) { %>
        <div class="excerpt">
          <div class="excerpt-body"><%- p.excerpt %></div>
        </div>
      <% } %>
      <% if (tags.length) { %>
        <div class="tags-row">
          <% tags.forEach(t => { %><a class="tag" href="/tags/<%= t %>"><%= t %></a><% }) %>
        </div>
      <% } %>
      <div class="page-stats" aria-label="Statistiques de l’article">
        <span title="Likes">💖 <strong><%= p.likes %></strong></span>
        <span title="Commentaires">💬 <strong><%= p.comment_count %></strong></span>
        <span title="Vues">👁️ <strong><%= p.views %></strong></span>
      </div>
      <div class="actions">
        <a class="btn success" data-icon="📖" href="/wiki/<%= p.slug_id %>">Ouvrir l’article</a>
        <form action="/wiki/<%= p.slug_id %>/like" method="post">
          <% if (p.userLiked) { %>
            <button class="btn unlike" data-icon="💔">Retirer (<%= p.likes %>)</button>
          <% } else { %>
            <button class="btn like" data-icon="💖">Like (<%= p.likes %>)</button>
          <% } %>
        </form>
        <button class="btn copy" data-icon="🔗" onclick="navigator.clipboard.writeText(location.origin + '/wiki/<%= p.slug_id %>')">Copier le lien</button>
      </div>
      <small>Publié: <%= p.created_at %></small>
    </div>
  <% }) %>
</div>

<h2>Articles</h2>
<form class="page-size" method="get" action="/">
  <input type="hidden" name="page" value="1">
  <label for="size">Articles par page :</label>
  <select id="size" name="size" onchange="this.form.submit()">
    <% sizeOptions.forEach(option => { %>
      <option value="<%= option %>" <%= option === size ? 'selected' : '' %>><%= option %></option>
    <% }) %>
  </select>
</form>
<div class="article-grid">
  <% rows.forEach(p => { const tags = (p.tagsCsv||'').split(',').filter(Boolean); %>
    <div class="card">
      <h3><strong><%= p.title %></strong></h3>
      <% if (p.excerpt) { %>
        <div class="excerpt">
          <div class="excerpt-body"><%- p.excerpt %></div>
        </div>
      <% } %>
      <% if (tags.length) { %>
        <div class="tags-row">
          <% tags.forEach(t => { %><a class="tag" href="/tags/<%= t %>"><%= t %></a><% }) %>
        </div>
      <% } %>
      <div class="page-stats" aria-label="Statistiques de l’article">
        <span title="Likes">💖 <strong><%= p.likes %></strong></span>
        <span title="Commentaires">💬 <strong><%= p.comment_count %></strong></span>
        <span title="Vues">👁️ <strong><%= p.views %></strong></span>
      </div>
      <div class="actions">
        <a class="btn success" data-icon="📖" href="/wiki/<%= p.slug_id %>">Ouvrir l’article</a>
        <form action="/wiki/<%= p.slug_id %>/like" method="post">
          <% if (p.userLiked) { %>
            <button class="btn unlike" data-icon="💔">Retirer (<%= p.likes %>)</button>
          <% } else { %>
            <button class="btn like" data-icon="💖">Like (<%= p.likes %>)</button>
          <% } %>
        </form>
        <button class="btn copy" data-icon="🔗" onclick="navigator.clipboard.writeText(location.origin + '/wiki/<%= p.slug_id %>')">Copier le lien</button>
      </div>
      <small>Publié: <%= p.created_at %></small>
    </div>
  <% }) %>
</div>

<div class="actions">
  <% if (page > 1) { %><a class="btn" data-icon="⬅️" href="/?page=<%= page-1 %>&size=<%= size %>">Précédent</a><% } %>
  <span>Page <%= page %> / <%= totalPages %></span>
  <% if (page < totalPages) { %><a class="btn" data-icon="➡️" href="/?page=<%= page+1 %>&size=<%= size %>">Suivant</a><% } %>
</div>
