<% title = 'Accueil'; %>
<% const heroName = typeof wikiName !== 'undefined' && wikiName ? wikiName : 'le wiki'; %>

<section class="hero-card">
  <div class="hero-card__body">
    <p class="hero-card__eyebrow">Bienvenue</p>
    <h1 class="hero-card__title">Explorez <%= heroName %></h1>
    <p class="hero-card__lede">
      Une base de connaissances collaborative comptant <strong><%= total %></strong> articles publi√©s.
    </p>
    <div class="hero-card__actions">
      <a class="btn success" data-icon="‚ú®" href="/search">Rechercher un article</a>
      <a class="btn" data-icon="‚úçÔ∏è" href="/new">√âcrire une page</a>
    </div>
  </div>
  <div class="hero-card__stats" aria-label="Indicateurs du wiki">
    <div class="stat-card">
      <span class="stat-card__label">Articles publi√©s</span>
      <span class="stat-card__value"><%= total %></span>
      <span class="stat-card__hint">depuis la cr√©ation</span>
    </div>
    <div class="stat-card">
      <span class="stat-card__label">Nouveaut√©s</span>
      <span class="stat-card__value"><%= recent.length %></span>
      <span class="stat-card__hint">sur les 7 derniers jours</span>
    </div>
    <div class="stat-card">
      <span class="stat-card__label">Articles list√©s</span>
      <span class="stat-card__value"><%= rows.length %></span>
      <span class="stat-card__hint">dans cette page</span>
    </div>
  </div>
</section>

<section id="recent" class="section-card">
  <div class="section-heading">
    <h2>Derniers articles (‚â§ 7 jours)</h2>
    <p class="section-heading__meta">
      <% if (recent.length) { %>
        <strong><%= recent.length %></strong> nouvelle<%= recent.length > 1 ? 's' : '' %> contribution<%= recent.length > 1 ? 's' : '' %> √† d√©couvrir.
      <% } else { %>
        Soyez la premi√®re personne √† publier un contenu cette semaine !
      <% } %>
    </p>
  </div>
  <div class="section-body">
    <% if (recent.length === 0) { %>
      <div class="card empty-card">Aucun article r√©cent.</div>
    <% } else { %>
      <div class="article-grid">
        <% recent.forEach(p => { const tags = (p.tagsCsv||'').split(',').filter(Boolean); %>
          <div class="card">
            <h3><strong><%= p.title %></strong></h3>
            <% if (p.excerpt) { %>
              <div class="excerpt">
                <div class="excerpt-body"><%- p.excerpt %></div>
              </div>
            <% } %>
            <% if (tags.length) { %>
              <div class="tags-row">
                <% tags.forEach(t => { %><a class="tag" href="/tags/<%= t %>"><%= t %></a><% }) %>
              </div>
            <% } %>
            <div class="page-stats" aria-label="Statistiques de l‚Äôarticle">
              <span title="Likes">üíñ <strong data-like-count-for="<%= p.slug_id %>"><%= p.likes %></strong></span>
              <span title="Commentaires">üí¨ <strong><%= p.comment_count %></strong></span>
              <span title="Vues">üëÅÔ∏è <strong><%= p.views %></strong></span>
            </div>
            <div class="actions">
              <a class="btn success" data-icon="üìñ" href="/wiki/<%= p.slug_id %>">Ouvrir l‚Äôarticle</a>
              <form action="/wiki/<%= p.slug_id %>/like" method="post" data-like-form-for="<%= p.slug_id %>">
                <button
                  class="btn <%= p.userLiked ? 'unlike' : 'like' %>"
                  data-icon="<%= p.userLiked ? 'üíî' : 'üíñ' %>"
                  data-label-liked="Retirer"
                  data-label-unliked="Like"
                  type="submit"
                >
                  <%= p.userLiked ? 'Retirer' : 'Like' %> (<%= p.likes %>)
                </button>
              </form>
              <button class="btn copy" data-icon="üîó" onclick="navigator.clipboard.writeText(location.origin + '/wiki/<%= p.slug_id %>')">Copier le lien</button>
            </div>
            <small>Publi√©: <%= p.created_at %></small>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>
</section>

<section class="section-card">
  <div class="section-heading section-heading--row">
    <div>
      <h2>Articles</h2>
      <p class="section-heading__meta">Parcourez la totalit√© des contenus publi√©s.</p>
    </div>
    <form class="page-size" method="get" action="/">
      <input type="hidden" name="page" value="1">
      <label class="sr-only" for="size">Articles par page</label>
      <div class="page-size__control">
        <span>Articles par page</span>
        <select id="size" name="size" onchange="this.form.submit()">
          <% sizeOptions.forEach(option => { %>
            <option value="<%= option %>" <%= option === size ? 'selected' : '' %>><%= option %></option>
          <% }) %>
        </select>
      </div>
    </form>
  </div>
  <div class="section-body">
    <div class="article-grid">
      <% rows.forEach(p => { const tags = (p.tagsCsv||'').split(',').filter(Boolean); %>
        <div class="card">
          <h3><strong><%= p.title %></strong></h3>
          <% if (p.excerpt) { %>
            <div class="excerpt">
              <div class="excerpt-body"><%- p.excerpt %></div>
            </div>
          <% } %>
          <% if (tags.length) { %>
            <div class="tags-row">
              <% tags.forEach(t => { %><a class="tag" href="/tags/<%= t %>"><%= t %></a><% }) %>
            </div>
          <% } %>
          <div class="page-stats" aria-label="Statistiques de l‚Äôarticle">
            <span title="Likes">üíñ <strong data-like-count-for="<%= p.slug_id %>"><%= p.likes %></strong></span>
            <span title="Commentaires">üí¨ <strong><%= p.comment_count %></strong></span>
            <span title="Vues">üëÅÔ∏è <strong><%= p.views %></strong></span>
          </div>
          <div class="actions">
            <a class="btn success" data-icon="üìñ" href="/wiki/<%= p.slug_id %>">Ouvrir l‚Äôarticle</a>
            <form action="/wiki/<%= p.slug_id %>/like" method="post" data-like-form-for="<%= p.slug_id %>">
              <button
                class="btn <%= p.userLiked ? 'unlike' : 'like' %>"
                data-icon="<%= p.userLiked ? 'üíî' : 'üíñ' %>"
                data-label-liked="Retirer"
                data-label-unliked="Like"
                type="submit"
              >
                <%= p.userLiked ? 'Retirer' : 'Like' %> (<%= p.likes %>)
              </button>
            </form>
            <button class="btn copy" data-icon="üîó" onclick="navigator.clipboard.writeText(location.origin + '/wiki/<%= p.slug_id %>')">Copier le lien</button>
          </div>
          <small>Publi√©: <%= p.created_at %></small>
        </div>
      <% }) %>
    </div>
  </div>
  <div class="section-footer actions">
    <% if (page > 1) { %><a class="btn" data-icon="‚¨ÖÔ∏è" href="/?page=<%= page-1 %>&size=<%= size %>">Pr√©c√©dent</a><% } %>
    <span class="pagination-status">Page <strong><%= page %></strong> / <%= totalPages %></span>
    <% if (page < totalPages) { %><a class="btn" data-icon="‚û°Ô∏è" href="/?page=<%= page+1 %>&size=<%= size %>">Suivant</a><% } %>
  </div>
</section>
