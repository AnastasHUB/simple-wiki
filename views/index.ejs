<% title = 'Accueil'; %>

<section class="home-hero">
  <div class="hero-intro">
    <p class="hero-eyebrow">Bienvenue sur <%= typeof wikiName !== 'undefined' ? wikiName : 'le wiki' %></p>
    <h1 class="hero-title">Explorez le savoir collectif et partagez vos dÃ©couvertes</h1>
    <p class="hero-lede">
      Consultez les derniÃ¨res contributions de la communautÃ©, enregistrez vos favoris et aidez Ã  enrichir la
      connaissance commune.
    </p>
    <div class="hero-actions">
      <a class="btn success" data-icon="âœ¨" href="/search">Parcourir le contenu</a>
      <a class="btn secondary" data-icon="âœï¸" href="/new">Proposer un article</a>
    </div>
  </div>
  <dl class="hero-stats" aria-label="Statistiques principales du wiki">
    <div class="hero-stat">
      <dt>Articles publiÃ©s</dt>
      <dd><strong><%= total %></strong></dd>
      <small>Un index qui sâ€™Ã©toffe jour aprÃ¨s jour.</small>
    </div>
    <div class="hero-stat">
      <dt>NouveautÃ©s (7 derniers jours)</dt>
      <dd><strong><%= recent.length %></strong></dd>
      <small>DerniÃ¨res entrÃ©es des contributrices et contributeurs.</small>
    </div>
    <div class="hero-stat">
      <dt>Articles affichÃ©s</dt>
      <dd><strong><%= rows.length %></strong></dd>
      <small>Selon vos paramÃ¨tres de pagination.</small>
    </div>
  </dl>
</section>

<section class="home-section">
  <div class="section-heading">
    <div class="section-heading-text">
      <h2>DerniÃ¨res publications</h2>
      <p>Les articles fraÃ®chement publiÃ©s au cours des sept derniers jours.</p>
    </div>
  </div>
  <div class="article-grid">
    <% if (recent.length === 0) { %>
      <div class="card card-empty">Aucun article rÃ©cent nâ€™a encore Ã©tÃ© publiÃ©. Revenez bientÃ´tÂ !</div>
    <% } %>
    <% recent.forEach(p => {
      const tags = (p.tagsCsv||'').split(',').filter(Boolean);
      const createdDate = new Date(p.created_at);
      const createdIso = !Number.isNaN(createdDate.valueOf()) ? createdDate.toISOString() : null;
    %>
      <article class="card article-card article-card--recent">
        <header class="card-header">
          <div class="card-title-group">
            <h3 class="card-title"><strong><%= p.title %></strong></h3>
            <span class="card-badge">ğŸ†• Nouveau</span>
          </div>
          <time class="card-meta" <%= createdIso ? `datetime="${createdIso}"` : '' %>>PubliÃ©Â : <%= p.created_at %></time>
        </header>
        <% if (p.excerpt) { %>
          <div class="excerpt">
            <div class="excerpt-body"><%- p.excerpt %></div>
          </div>
        <% } %>
        <% if (tags.length) { %>
          <div class="tags-row">
            <% tags.forEach(t => { %><a class="tag" href="/tags/<%= t %>"><%= t %></a><% }) %>
          </div>
        <% } %>
        <div class="page-stats" aria-label="Statistiques de lâ€™article">
          <span title="Likes">ğŸ’– <strong data-like-count-for="<%= p.slug_id %>"><%= p.likes %></strong></span>
          <span title="Commentaires">ğŸ’¬ <strong><%= p.comment_count %></strong></span>
          <span title="Vues">ğŸ‘ï¸ <strong><%= p.views %></strong></span>
        </div>
        <footer class="card-footer">
          <div class="card-actions">
            <a class="btn success" data-icon="ğŸ“–" href="/wiki/<%= p.slug_id %>">Ouvrir lâ€™article</a>
            <form action="/wiki/<%= p.slug_id %>/like" method="post" data-like-form-for="<%= p.slug_id %>">
              <button
                class="btn <%= p.userLiked ? 'unlike' : 'like' %>"
                data-icon="<%= p.userLiked ? 'ğŸ’”' : 'ğŸ’–' %>"
                data-label-liked="Retirer"
                data-label-unliked="Like"
                type="submit"
              >
                <%= p.userLiked ? 'Retirer' : 'Like' %> (<%= p.likes %>)
              </button>
            </form>
            <button
              class="btn copy"
              data-icon="ğŸ”—"
              type="button"
              onclick="navigator.clipboard.writeText(location.origin + '/wiki/<%= p.slug_id %>')"
            >
              Copier le lien
            </button>
          </div>
        </footer>
      </article>
    <% }) %>
  </div>
</section>

<section class="home-section">
  <div class="section-heading">
    <div class="section-heading-text">
      <h2>Tous les articles</h2>
      <p>Parcourez lâ€™ensemble des contenus disponibles sur la plateforme.</p>
    </div>
    <% const perPageFieldId = `${pagination.pageParam}-per-page`; %>
    <form class="page-size" method="get" action="/">
      <input type="hidden" name="<%= pagination.pageParam %>" value="1">
      <% if (pagination.preservedQuery && pagination.preservedQuery.length) { %>
        <% pagination.preservedQuery.forEach(pair => { %>
          <input type="hidden" name="<%= pair.name %>" value="<%= pair.value %>">
        <% }) %>
      <% } %>
      <label for="<%= perPageFieldId %>">Articles par page</label>
      <select id="<%= perPageFieldId %>" name="<%= pagination.perPageParam %>" onchange="this.form.submit()">
        <% pagination.perPageOptions.forEach(option => { %>
          <option value="<%= option %>" <%= option === pagination.perPage ? 'selected' : '' %>><%= option %></option>
        <% }) %>
      </select>
    </form>
  </div>
  <div class="article-grid">
    <% rows.forEach(p => {
      const tags = (p.tagsCsv||'').split(',').filter(Boolean);
      const createdDate = new Date(p.created_at);
      const createdIso = !Number.isNaN(createdDate.valueOf()) ? createdDate.toISOString() : null;
    %>
      <article class="card article-card">
        <header class="card-header">
          <h3 class="card-title"><strong><%= p.title %></strong></h3>
          <time class="card-meta" <%= createdIso ? `datetime="${createdIso}"` : '' %>>PubliÃ©Â : <%= p.created_at %></time>
        </header>
        <% if (p.excerpt) { %>
          <div class="excerpt">
            <div class="excerpt-body"><%- p.excerpt %></div>
          </div>
        <% } %>
        <% if (tags.length) { %>
          <div class="tags-row">
            <% tags.forEach(t => { %><a class="tag" href="/tags/<%= t %>"><%= t %></a><% }) %>
          </div>
        <% } %>
        <div class="page-stats" aria-label="Statistiques de lâ€™article">
          <span title="Likes">ğŸ’– <strong data-like-count-for="<%= p.slug_id %>"><%= p.likes %></strong></span>
          <span title="Commentaires">ğŸ’¬ <strong><%= p.comment_count %></strong></span>
          <span title="Vues">ğŸ‘ï¸ <strong><%= p.views %></strong></span>
        </div>
        <footer class="card-footer">
          <div class="card-actions">
            <a class="btn success" data-icon="ğŸ“–" href="/wiki/<%= p.slug_id %>">Ouvrir lâ€™article</a>
            <form action="/wiki/<%= p.slug_id %>/like" method="post" data-like-form-for="<%= p.slug_id %>">
              <button
                class="btn <%= p.userLiked ? 'unlike' : 'like' %>"
                data-icon="<%= p.userLiked ? 'ğŸ’”' : 'ğŸ’–' %>"
                data-label-liked="Retirer"
                data-label-unliked="Like"
                type="submit"
              >
                <%= p.userLiked ? 'Retirer' : 'Like' %> (<%= p.likes %>)
              </button>
            </form>
            <button
              class="btn copy"
              data-icon="ğŸ”—"
              type="button"
              onclick="navigator.clipboard.writeText(location.origin + '/wiki/<%= p.slug_id %>')"
            >
              Copier le lien
            </button>
          </div>
        </footer>
      </article>
    <% }) %>
  </div>
</section>

<div class="actions pagination">
  <span class="pagination-status">
    Page <strong><%= pagination.page %></strong> / <%= pagination.totalPages %>
  </span>
  <div class="pager">
    <% if (pagination.hasPrevious) { %>
      <a class="btn" data-icon="â¬…ï¸" href="<%= pagination.previousUrl %>">PrÃ©cÃ©dent</a>
    <% } else { %>
      <span class="btn" data-icon="â¬…ï¸" aria-disabled="true">PrÃ©cÃ©dent</span>
    <% } %>
    <% if (pagination.hasNext) { %>
      <a class="btn" data-icon="â¡ï¸" href="<%= pagination.nextUrl %>">Suivant</a>
    <% } else { %>
      <span class="btn" data-icon="â¡ï¸" aria-disabled="true">Suivant</span>
    <% } %>
  </div>
</div>
