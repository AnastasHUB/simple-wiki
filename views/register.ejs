<% title = "Inscription"; %>
<h1>Créer un compte</h1>

<% const captchaConfig = typeof captcha !== 'undefined' ? captcha : null; %>
<% if (typeof registrationDisabled !== 'undefined' && registrationDisabled && !captchaConfig) { %>
  <div class="card warning">
    Les inscriptions sont momentanément indisponibles car aucun captcha n'est configuré.
  </div>
  <p>
    Merci de réessayer plus tard ou de contacter un administrateur si le problème persiste.
  </p>
<% } else { %>
  <% const formErrors = typeof errors !== 'undefined' && Array.isArray(errors) ? errors : []; %>
  <% const formValues = typeof values !== 'undefined' && values && typeof values === 'object' ? values : {}; %>
  <% if (formErrors.length) { %>
    <div class="card error">
      <h2>Impossible de créer le compte</h2>
      <ul>
        <% formErrors.forEach(function(message) { %>
          <li><%= message %></li>
        <% }); %>
      </ul>
    </div>
  <% } %>
  <form method="post" action="/register" class="stacked-form" id="registerForm">
    <%- include('partials/csrf_field') %>
    <label for="register-username">Nom d'utilisateur</label>
    <input
      id="register-username"
      type="text"
      name="username"
      required
      minlength="3"
      maxlength="32"
      pattern="[A-Za-z0-9_.-]+"
      autocomplete="username"
      value="<%= formValues.username ? formValues.username : '' %>"
    />
    <p class="form-help">Autorisé&nbsp;: lettres, chiffres, points, tirets et underscores.</p>

    <label for="register-password">Mot de passe</label>
    <input
      id="register-password"
      type="password"
      name="password"
      required
      minlength="8"
      autocomplete="new-password"
    />
    <p class="form-help">Utilisez un mot de passe robuste d'au moins 8 caractères.</p>

    <fieldset class="captcha-selector">
      <legend>Vérification anti-robot</legend>
      <p class="form-help">
        Résolvez l'opération ci-dessous pour confirmer que vous n'êtes pas un robot.
      </p>
      <p class="captcha-question">
        <strong><%= captchaConfig.question %> = ?</strong>
      </p>
      <label for="captcha-answer">Votre réponse <span class="text-required">*</span></label>
      <input
        id="captcha-answer"
        type="text"
        name="captcha"
        inputmode="numeric"
        pattern="[0-9]*"
        required
        autocomplete="off"
      />
      <input type="hidden" name="captchaToken" value="<%= captchaConfig.token %>" />
    </fieldset>

    <div class="actions">
      <button class="btn success" type="submit" data-icon="✨">Créer mon compte</button>
    </div>
  </form>
  <p class="form-help">
    Vous avez déjà un compte&nbsp;?<a href="/login">Connectez-vous ici</a>.
  </p>

<% } %>
