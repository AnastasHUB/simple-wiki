<% title = t('register.title'); %>
<h1><%= t('register.heading') %></h1>

<% const captchaConfig = typeof captcha !== 'undefined' ? captcha : null; %>
<% if (typeof registrationDisabled !== 'undefined' && registrationDisabled && !captchaConfig) { %>
  <div class="card warning">
    <%= t('register.closed.noCaptcha') %>
  </div>
  <p>
    <%= t('register.closed.tryLater') %>
  </p>
<% } else { %>
  <% const formErrors = typeof errors !== 'undefined' && Array.isArray(errors) ? errors : []; %>
  <% const formValues = typeof values !== 'undefined' && values && typeof values === 'object' ? values : {}; %>
  <% if (formErrors.length) { %>
    <div class="card error">
      <h2><%= t('register.errors.title') %></h2>
      <ul>
        <% formErrors.forEach(function(message) { %>
          <li><%= message %></li>
        <% }); %>
      </ul>
    </div>
  <% } %>
  <form method="post" action="/register" class="stacked-form" id="registerForm">
    <%- include('partials/csrf_field') %>
    <label for="register-username"><%= t('register.fields.username.label') %></label>
    <input
      id="register-username"
      type="text"
      name="username"
      required
      minlength="3"
      maxlength="32"
      pattern="[A-Za-z0-9_.-]+"
      autocomplete="username"
      value="<%= formValues.username ? formValues.username : '' %>"
    />
    <p class="form-help"><%= t('register.fields.username.help') %></p>

    <label for="register-password"><%= t('register.fields.password.label') %></label>
    <input
      id="register-password"
      type="password"
      name="password"
      required
      minlength="8"
      autocomplete="new-password"
    />
    <p class="form-help"><%= t('register.fields.password.help') %></p>

    <fieldset class="captcha-selector">
      <legend><%= t('register.captcha.legend') %></legend>
      <p class="form-help">
        <%= t('register.captcha.help') %>
      </p>
      <p class="captcha-question">
        <strong><%= captchaConfig.question %> = ?</strong>
      </p>
      <label for="captcha-answer"><%= t('register.captcha.answer') %> <span class="text-required">*</span></label>
      <input
        id="captcha-answer"
        type="text"
        name="captcha"
        inputmode="numeric"
        pattern="[0-9]*"
        required
        autocomplete="off"
      />
      <input type="hidden" name="captchaToken" value="<%= captchaConfig.token %>" />
    </fieldset>

    <div class="actions">
      <button class="btn success" type="submit" data-icon="âœ¨"><%= t('register.actions.submit') %></button>
    </div>
  </form>
  <p class="form-help">
    <%= t('register.help.haveAccount') %><a href="/login"> <%= t('register.help.loginHere') %></a>.
  </p>

<% } %>
