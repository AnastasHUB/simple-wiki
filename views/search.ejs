<% title = 'Recherche'; %>
<h1>RÃ©sultats pour Â« <%= q %> Â»</h1>

<div class="search-meta">
  <p><strong><%= total %></strong> rÃ©sultat<%= total > 1 ? 's' : '' %> trouvÃ©<%= total > 1 ? 's' : '' %>.</p>
  <% const perPageFieldId = `${pagination.pageParam}-per-page`; %>
  <form class="page-size" method="get">
    <input type="hidden" name="<%= pagination.pageParam %>" value="1">
    <% if (pagination.preservedQuery && pagination.preservedQuery.length) { %>
      <% pagination.preservedQuery.forEach(pair => { %>
        <input type="hidden" name="<%= pair.name %>" value="<%= pair.value %>">
      <% }) %>
    <% } %>
    <label for="<%= perPageFieldId %>">RÃ©sultats par page</label>
    <select id="<%= perPageFieldId %>" name="<%= pagination.perPageParam %>" onchange="this.form.submit()">
      <% pagination.perPageOptions.forEach(option => { %>
        <option value="<%= option %>" <%= option === pagination.perPage ? 'selected' : '' %>><%= option %></option>
      <% }) %>
    </select>
  </form>
</div>

<% if (mode !== 'fts') { %>
  <p><em>Recherche basique utilisÃ©e car lâ€™index plein texte <% if (!ftsAvailable) { %>nâ€™est pas disponible<% } else { %>nâ€™a pas pu Ãªtre utilisÃ© pour cette requÃªte<% } %>.</em></p>
<% } %>

<div class="article-grid">
  <% if (!rows.length) { %>
    <div class="card">Aucun rÃ©sultat.</div>
  <% } %>

  <% rows.forEach(p => {
       const tags = (p.tagsCsv || '').split(',').filter(Boolean);
       const showScore = mode === 'fts' && Number.isFinite(p.score);
  %>
    <div class="card">
      <h3><strong><%= p.title %></strong></h3>
      <% if (p.snippet) { %>
        <div class="excerpt">
          <div class="excerpt-body"><%- p.snippet %></div>
        </div>
      <% } else if (p.excerpt) { %>
        <div class="excerpt">
          <div class="excerpt-body"><%- p.excerpt %></div>
        </div>
      <% } %>

      <% if (showScore) { %>
        <div class="meta">Score BM25 : <%= p.score.toFixed(2) %></div>
      <% } %>

      <% if (tags.length) { %>
        <div class="tags-row">
          <% tags.forEach(t => { %>
            <a class="tag" href="/tags/<%= t %>"><%= t %></a>
          <% }) %>
        </div>
      <% } %>

      <div class="actions">
        <a class="btn success" data-icon="ğŸ“–" href="/wiki/<%= p.slug_id %>">Ouvrir lâ€™article</a>
        <button class="btn copy" data-icon="ğŸ”—"
          onclick="navigator.clipboard.writeText(location.origin + '/wiki/<%= p.slug_id %>')">
          Copier le lien
        </button>
      </div>
    </div>
  <% }) %>
</div>

<div class="actions pagination">
  <span class="pagination-status">
    Page <strong><%= pagination.page %></strong> / <%= pagination.totalPages %>
  </span>
  <div class="pager">
    <% if (pagination.hasPrevious) { %>
      <a class="btn" data-icon="â¬…ï¸" href="<%= pagination.previousUrl %>">PrÃ©cÃ©dent</a>
    <% } else { %>
      <span class="btn" data-icon="â¬…ï¸" aria-disabled="true">PrÃ©cÃ©dent</span>
    <% } %>
    <% if (pagination.hasNext) { %>
      <a class="btn" data-icon="â¡ï¸" href="<%= pagination.nextUrl %>">Suivant</a>
    <% } else { %>
      <span class="btn" data-icon="â¡ï¸" aria-disabled="true">Suivant</span>
    <% } %>
  </div>
</div>
