<% title = t('account.submissions.title'); %>
<h1><%= t('account.submissions.heading') %></h1>
<p class="text-muted mb-lg"><%= t('account.submissions.intro') %></p>
<% if (!user) { %>
  <p class="alert alert-info"><%= t('account.submissions.anonymousNotice') %></p>
<% } %>

<section class="card mb-xl">
  <h2><%= t('account.submissions.pending') %> (<%= pendingPagination.totalItems %>)</h2>
  <% if (!pending.length) { %>
    <p>Aucune contribution en attente de validation pour le moment.</p>
  <% } else { %>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th><%= t('account.submissions.table.type') %></th>
            <th><%= t('account.submissions.table.proposedTitle') %></th>
            <th><%= t('account.submissions.table.linkedPage') %></th>
            <th><%= t('account.submissions.table.tags') %></th>
            <th><%= t('account.submissions.table.submittedAt') %></th>
          </tr>
        </thead>
        <tbody>
          <% pending.forEach(item => { %>
            <tr>
              <td><code><%= item.snowflake_id %></code></td>
              <td><%= item.type === 'edit' ? t('account.submissions.type.edit') : t('account.submissions.type.create') %></td>
              <td><strong><%= item.title %></strong></td>
              <td>
                <% if (item.current_slug) { %>
                  <a href="/wiki/<%= item.current_slug %>"><code><%= item.current_slug %></code></a>
                <% } else { %>
                  –
                <% } %>
              </td>
              <td>
                <% if (item.tag_list && item.tag_list.length) { %>
                  <%= item.tag_list.join(', ') %>
                <% } else { %>
                  –
                <% } %>
              </td>
              <td><%= new Date(item.created_at).toLocaleString(lang === 'en' ? 'en-US' : 'fr-FR') %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <%- include('../admin/paginationControls', { pagination: pendingPagination }) %>
  <% } %>
</section>

<section class="card mb-xl">
  <h2><%= t('account.submissions.approved') %> (<%= approvedPagination.totalItems %>)</h2>
  <% if (!approved.length) { %>
    <p>Vous n’avez pas encore de contribution approuvée.</p>
  <% } else { %>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th><%= t('account.submissions.table.type') %></th>
            <th><%= t('account.submissions.table.proposedTitle') %></th>
            <th><%= t('account.submissions.table.publishedAt') %></th>
            <th><%= t('account.submissions.table.finalPage') %></th>
            <th><%= t('account.submissions.table.moderatorNote') %></th>
          </tr>
        </thead>
        <tbody>
          <% approved.forEach(item => { %>
            <tr>
              <td><code><%= item.snowflake_id %></code></td>
              <td><%= item.type === 'edit' ? t('account.submissions.type.edit') : t('account.submissions.type.create') %></td>
              <td><strong><%= item.title %></strong></td>
              <td>
                <% if (item.reviewed_at) { %>
                  <%= new Date(item.reviewed_at).toLocaleString(lang === 'en' ? 'en-US' : 'fr-FR') %>
                <% } else { %>
                  –
                <% } %>
              </td>
              <td>
                <% if (item.result_slug_id) { %>
                  <a href="/wiki/<%= item.result_slug_id %>"><code><%= item.result_slug_id %></code></a>
                <% } else if (item.target_slug_id) { %>
                  <a href="/wiki/<%= item.target_slug_id %>"><code><%= item.target_slug_id %></code></a>
                <% } else if (item.current_slug) { %>
                  <a href="/wiki/<%= item.current_slug %>"><code><%= item.current_slug %></code></a>
                <% } else { %>
                  –
                <% } %>
              </td>
              <td><%= item.review_note ? item.review_note : '–' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <%- include('../admin/paginationControls', { pagination: approvedPagination }) %>
  <% } %>
</section>

<section class="card">
  <h2><%= t('account.submissions.rejected') %> (<%= rejectedPagination.totalItems %>)</h2>
  <% if (!rejected.length) { %>
    <p>Aucune contribution rejetée n’a été trouvée.</p>
  <% } else { %>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th><%= t('account.submissions.table.type') %></th>
            <th><%= t('account.submissions.table.proposedTitle') %></th>
            <th><%= t('account.submissions.table.decisionAt') %></th>
            <th><%= t('account.submissions.table.reason') %></th>
          </tr>
        </thead>
        <tbody>
          <% rejected.forEach(item => { %>
            <tr>
              <td><code><%= item.snowflake_id %></code></td>
              <td><%= item.type === 'edit' ? t('account.submissions.type.edit') : t('account.submissions.type.create') %></td>
              <td><strong><%= item.title %></strong></td>
              <td>
                <% if (item.reviewed_at) { %>
                  <%= new Date(item.reviewed_at).toLocaleString(lang === 'en' ? 'en-US' : 'fr-FR') %>
                <% } else { %>
                  –
                <% } %>
              </td>
              <td><%= item.review_note ? item.review_note : '–' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <%- include('../admin/paginationControls', { pagination: rejectedPagination }) %>
  <% } %>
</section>
