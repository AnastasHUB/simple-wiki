<% title = 'Paiement premium'; %>
<%
  const hasPaymentAmount =
    payment && typeof payment.amount === 'number' && payment.currency;
  const amountLabel = hasPaymentAmount
    ? (payment.amount / 100).toLocaleString('fr-FR', {
        style: 'currency',
        currency: payment.currency.toUpperCase(),
      })
    : '';
  const effectiveDurationLabel =
    durationLabel && durationLabel.length
      ? durationLabel
      : durationDays > 0
      ? `${durationDays} jour${durationDays > 1 ? 's' : ''}`
      : '';
  const shouldAutoRefresh = status === 'pending' || status === 'processing';
%>
<section class="card">
  <h1>Paiement premium</h1>
  <% if (status === 'completed' && premiumCode && premiumCode.code) { %>
    <p class="text-success">Merci pour votre achat&nbsp;!</p>
    <p>
      Votre code premium vous octroie <strong><%= effectiveDurationLabel %></strong>
      d'acc√®s suppl√©mentaires.
    </p>
    <% if (hasPaymentAmount) { %>
      <p class="text-muted">Montant r√©gl√©&nbsp;: <%= amountLabel %>.</p>
    <% } %>
    <div class="card mt-sm">
      <p class="text-muted mb-xs">Code premium √† utiliser</p>
      <p class="text-lg"><strong><%= premiumCode.code %></strong></p>
      <p class="text-muted mb-0">
        Rendez-vous dans votre profil pour l'activer imm√©diatement.
      </p>
    </div>
    <p class="mt-md">
      <a class="btn success" data-icon="üë§" href="/account/profile">Retourner √† mon profil</a>
    </p>
  <% } else if (status === 'processing') { %>
    <p>
      Votre paiement a bien √©t√© confirm√©. Nous g√©n√©rons votre code premium ;
      cette page se mettra √† jour automatiquement dans quelques instants.
    </p>
    <% if (hasPaymentAmount) { %>
      <p class="text-muted">Montant r√©gl√©&nbsp;: <%= amountLabel %>.</p>
    <% } %>
    <p class="mt-md">
      <a class="btn secondary" href="/account/profile">Retourner √† mon profil</a>
    </p>
  <% } else { %>
    <p>
      Le paiement est toujours en cours de traitement. D√®s qu'il sera confirm√©,
      votre code premium appara√Ætra sur cette page.
    </p>
    <% if (hasPaymentAmount) { %>
      <p class="text-muted">Montant estim√©&nbsp;: <%= amountLabel %>.</p>
    <% } %>
    <p class="mt-md">
      <a class="btn secondary" href="/account/profile">Retourner √† mon profil</a>
    </p>
  <% } %>
</section>
<% if (shouldAutoRefresh) { %>
  <script>
    setTimeout(() => {
      window.location.reload();
    }, 5000);
  </script>
<% } %>
