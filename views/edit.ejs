<% title = page ? 'Éditer' : 'Nouvelle page'; %>
<h1><%= title %></h1>
<% const isSubmission = typeof submissionMode !== 'undefined' ? submissionMode : false; %>
<% const authorFieldValue = typeof authorName !== 'undefined'
  ? authorName
  : (page && page.author ? page.author : ''); %>
<% if (isSubmission) { %>
  <div class="card card-highlight mb-md">
    <p class="mt-0 mb-0">
      Votre proposition sera enregistrée avec votre adresse IP et un administrateur devra la valider avant publication.
    </p>
  </div>
<% } %>
<form method="post">
  <label>Titre</label>
  <input type="text" name="title" value="<%= page ? page.title : '' %>" required />
  <label>Contenu (liens [[internes]])</label>
  <textarea name="content" id="contentField" rows="18" required hidden><%- page ? page.content : '' %></textarea>
  <div
    class="markdown-editor-shell"
    data-markdown-editor
    data-target="#contentField"
  >
    <div
      class="markdown-toolbar"
      role="toolbar"
      aria-label="Outils de mise en forme"
    >
      <button type="button" class="toolbar-btn" data-md-action="heading-2" aria-label="Titre niveau 2" title="Titre niveau 2">H2</button>
      <button type="button" class="toolbar-btn" data-md-action="heading-3" aria-label="Titre niveau 3" title="Titre niveau 3">H3</button>
      <button type="button" class="toolbar-btn" data-md-action="bold" aria-label="Gras" title="Gras"><span aria-hidden="true">𝐆</span></button>
      <button type="button" class="toolbar-btn" data-md-action="italic" aria-label="Italique" title="Italique"><span aria-hidden="true"><em>I</em></span></button>
      <button type="button" class="toolbar-btn" data-md-action="strike" aria-label="Barré" title="Barré"><span aria-hidden="true">S̶</span></button>
      <button type="button" class="toolbar-btn" data-md-action="code" aria-label="Code inline" title="Code inline"><span aria-hidden="true">`</span></button>
      <button type="button" class="toolbar-btn" data-md-action="quote" aria-label="Citation" title="Citation"><span aria-hidden="true">❝</span></button>
      <button type="button" class="toolbar-btn" data-md-action="link" aria-label="Lien" title="Lien"><span aria-hidden="true">🔗</span></button>
      <button type="button" class="toolbar-btn" data-md-action="code-block" aria-label="Bloc de code" title="Bloc de code"><span aria-hidden="true">&lt;/&gt;</span></button>
      <button type="button" class="toolbar-btn" data-md-action="spoiler" aria-label="Bloc spoiler" title="Bloc spoiler"><span aria-hidden="true">🕵️</span></button>
      <button type="button" class="toolbar-btn" data-md-action="katex" aria-label="Formule mathématique" title="Formule mathématique"><span aria-hidden="true">∑</span></button>
      <button type="button" class="toolbar-btn" data-md-action="mermaid" aria-label="Diagramme Mermaid" title="Diagramme Mermaid"><span aria-hidden="true">🗺️</span></button>
      <button
        type="button"
        class="toolbar-btn emoji-trigger"
        data-emoji-trigger
        aria-label="Insérer un emoji"
        title="Insérer un emoji"
      >😊</button>
      <div class="emoji-popover" data-emoji-picker hidden></div>
    </div>
    <div class="markdown-editor-body">
      <div class="markdown-editor-pane">
        <textarea
          class="markdown-input"
          rows="18"
          data-editor-input
          aria-label="Éditeur Markdown"
        ></textarea>
        <div
          class="link-suggestions"
          data-link-suggestions
          hidden
          aria-label="Suggestions de liens internes"
        ></div>
      </div>
      <div class="markdown-preview-pane">
        <div class="markdown-preview-heading">Prévisualisation</div>
        <div class="markdown-preview" data-editor-preview aria-live="polite"></div>
      </div>
    </div>
    <div class="editor-status" data-editor-status role="status" aria-live="polite"></div>
  </div>
  <label for="author-field">Auteur affiché</label>
  <input
    id="author-field"
    type="text"
    name="author"
    maxlength="80"
    value="<%= authorFieldValue %>"
    placeholder="Votre nom ou pseudo"
  />
  <p class="editor-hint">
    Ce nom sera affiché comme auteur de l’article. Si vous n’êtes pas connecté, choisissez le pseudo de votre choix.
  </p>
  <label>Tags (séparés par des virgules)</label>
  <input type="text" name="tags" value="<%= tags %>" />
  <div class="actions">
    <% if (isSubmission) { %>
      <button class="btn success" data-icon="📨" type="submit">Envoyer ma proposition</button>
    <% } else { %>
      <button class="btn success" data-icon="💾" type="submit">Enregistrer</button>
    <% } %>
  </div>
</form>

