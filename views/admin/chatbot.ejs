<% title='Chatbot IA'; %>
<h1>Assistant conversationnel</h1>
<p class="mb-md text-muted">
  Alimentez le chatbot interne avec des documents en texte brut. Chaque document est analys√© pour proposer des r√©ponses
  contextuelles aux utilisateurs sur la page ¬´ Assistant IA ¬ª.
</p>

<section class="card mb-xl">
  <h2>Ajouter un document d'entra√Ænement</h2>
  <form method="post" action="/admin/chatbot" class="stack-form gap-sm">
    <label class="stack-form">
      <span class="text-sm text-muted">Titre (optionnel)</span>
      <input type="text" name="title" maxlength="200" placeholder="Ex¬†: Guide d'onboarding" />
    </label>
    <label class="stack-form">
      <span class="text-sm text-muted">Contenu</span>
      <textarea name="content" rows="10" required placeholder="Collez ici le texte d'entra√Ænement"></textarea>
    </label>
    <div>
      <button class="btn success" data-icon="üíæ" type="submit">Enregistrer le document</button>
    </div>
  </form>
</section>

<section class="card">
  <h2>Corpus actuel</h2>
  <% if (Array.isArray(documents) && documents.length) { %>
    <p>
      <strong><%= documents.length %></strong> document(s) d'entra√Ænement ‚Äî environ
      <strong><%= totalWords %></strong> mot(s) index√©s.
    </p>
    <div class="table-wrap">
      <table class="data-table chatbot-documents">
        <thead>
          <tr>
            <th scope="col">Titre</th>
            <th scope="col">Mots</th>
            <th scope="col">Aper√ßu</th>
            <th scope="col">Ajout√©</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% documents.forEach((doc) => { %>
            <% const title = doc.title && doc.title.trim() ? doc.title.trim() : 'Sans titre'; %>
            <% const createdLabel = doc.createdAt ? new Date(doc.createdAt).toLocaleString('fr-FR') : '‚Äî'; %>
            <tr>
              <td><strong><%= title %></strong></td>
              <td><%= doc.wordCount %></td>
              <td class="text-sm text-muted"><%= doc.preview %></td>
              <td><%= createdLabel %></td>
              <td>
                <form
                  method="post"
                  action="/admin/chatbot/<%= doc.snowflakeId %>/delete"
                  onsubmit="return confirm('Supprimer ce document du corpus¬†?')"
                >
                  <button class="btn unlike" data-icon="üóëÔ∏è" type="submit">Supprimer</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <p class="mt-sm text-muted">Aucun document enregistr√© pour le moment. Ajoutez votre premier texte ci-dessus.</p>
  <% } %>
</section>
