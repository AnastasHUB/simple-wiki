<% title='Utilisateurs'; %>
<h1>Utilisateurs (admins uniquement)</h1>
<form method="get" class="card mb-md">
  <div class="flex flex-wrap gap-sm items-end">
    <label class="stack-form">
      <span class="text-sm text-muted">Rechercher</span>
      <input
        type="text"
        name="search"
        value="<%= typeof searchTerm === 'string' ? searchTerm : '' %>"
        placeholder="ID, nom, pseudo‚Ä¶"
        class="flex-basis-260"
      />
    </label>
    <input type="hidden" name="page" value="1" />
    <input type="hidden" name="perPage" value="<%= pagination.perPage %>" />
    <button class="btn" data-icon="üîç" type="submit">Rechercher</button>
    <% if (searchTerm) { %>
      <a class="btn secondary" href="/admin/users">R√©initialiser</a>
    <% } %>
  </div>
</form>
<form method="post" class="card">
  <div class="flex flex-wrap gap-sm items-end">
    <label class="stack-form">
      <span class="text-sm text-muted">Nom d'utilisateur</span>
      <input type="text" name="username" placeholder="nouvel utilisateur" required />
    </label>
    <label class="stack-form">
      <span class="text-sm text-muted">Mot de passe</span>
      <input type="password" name="password" placeholder="mot de passe" required />
    </label>
    <label class="stack-form">
      <span class="text-sm text-muted">R√¥le</span>
      <select name="role">
        <option value="admin">Administrateur</option>
        <option value="moderator">Mod√©rateur</option>
      </select>
    </label>
    <button class="btn success" data-icon="‚ûï" type="submit">Ajouter</button>
  </div>
</form>
<% if (!users.length) { %>
  <p class="card mt-md">Aucun utilisateur trouv√©.</p>
<% } else { %>
  <div class="table-wrap mt-md">
    <table class="data-table">
      <thead>
        <tr><th>ID</th><th>Nom</th><th>Pseudo commentaire</th><th>Admin</th><th>Mod√©rateur</th><th></th></tr>
      </thead>
      <tbody>
      <% users.forEach(u=>{ %>
        <tr>
          <td><%= u.id %></td>
          <td><%= u.username %></td>
          <td>
            <form method="post" action="/admin/users/<%= u.id %>/display-name" class="flex gap-sm items-center">
              <input
                type="text"
                name="displayName"
                maxlength="80"
                value="<%= u.display_name || '' %>"
                placeholder="Nom affich√©"
                aria-label="Pseudo pour <%= u.username %>"
                class="flex-basis-220"
              />
              <button class="btn secondary" data-icon="üíæ" type="submit">Enregistrer</button>
            </form>
          </td>
          <td><%= u.is_admin ? 'Oui' : 'Non' %></td>
          <td>
            <div class="flex gap-sm items-center">
              <span><%= u.is_moderator ? 'Oui' : 'Non' %></span>
              <form method="post" action="/admin/users/<%= u.id %>/moderator">
                <input type="hidden" name="enable" value="<%= u.is_moderator ? '0' : '1' %>" />
                <button
                  class="btn <%= u.is_moderator ? 'secondary' : 'success' %>"
                  data-icon="<%= u.is_moderator ? '‚ùé' : '‚≠ê' %>"
                  type="submit"
                >
                  <%= u.is_moderator ? 'Retirer' : 'Nommer' %>
                </button>
              </form>
            </div>
          </td>
          <td>
            <form method="post" action="/admin/users/<%= u.id %>/delete" onsubmit="return confirm('Supprimer cet utilisateur ?')">
              <button class="btn danger" data-icon="üóëÔ∏è">Supprimer</button>
            </form>
          </td>
        </tr>
      <% }) %>
      </tbody>
    </table>
  </div>
  <%- include('./paginationControls', { pagination }) %>
<% } %>
