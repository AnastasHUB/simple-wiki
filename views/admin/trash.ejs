<% title = 'Corbeille'; %>
<h1>Corbeille</h1>

<form method="get" class="card mb-md">
  <div class="flex flex-wrap gap-sm items-end">
    <label class="stack-form">
      <span class="text-sm text-muted">Rechercher</span>
      <input
        type="text"
        name="search"
        value="<%= typeof searchTerm === 'string' ? searchTerm : '' %>"
        placeholder="Titre, slug, auteur‚Ä¶"
        class="flex-basis-180"
      />
    </label>
    <input type="hidden" name="page" value="1" />
    <input type="hidden" name="perPage" value="<%= pagination.perPage %>" />
    <button class="btn" data-icon="üîç" type="submit">Rechercher</button>
    <% if (searchTerm) { %>
      <a class="btn secondary" href="/admin/trash">R√©initialiser</a>
    <% } %>
  </div>
</form>

<section class="card">
  <div class="card-header">
    <div class="card-title-group">
      <h2 class="mt-0">Pages supprim√©es</h2>
      <p class="text-muted">G√©rez d√©finitivement les contenus retir√©s du wiki.</p>
    </div>
    <% if (trashedPages.length) { %>
      <form method="post" action="/admin/trash/empty" onsubmit="return confirm('Vider enti√®rement la corbeille ? Cette action est irr√©versible.');">
        <button class="btn danger" data-icon="üßπ" type="submit">Vider la corbeille</button>
      </form>
    <% } %>
  </div>
  <% if (!trashedPages.length) { %>
    <p>Aucun √©l√©ment dans la corbeille pour le moment.</p>
  <% } else { %>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>Titre</th>
            <th>Slug</th>
            <th>Supprim√©e le</th>
            <th>Supprim√© par</th>
            <th>Tags</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% trashedPages.forEach(page => { %>
            <tr>
              <td>
                <div class="table-title"><strong><%= page.title || 'Sans titre' %></strong></div>
                <div class="table-meta text-muted">
                  Cr√©√©e le <%= page.created_at ? new Date(page.created_at).toLocaleString('fr-FR') : '‚Äî' %>
                  <% if (page.updated_at) { %>
                    ¬∑ Derni√®re mise √† jour le <%= new Date(page.updated_at).toLocaleString('fr-FR') %>
                  <% } %>
                </div>
              </td>
              <td><code><%= page.slug_id %></code></td>
              <td><%= page.deleted_at ? new Date(page.deleted_at).toLocaleString('fr-FR') : '‚Äî' %></td>
              <td><%= page.deleted_by || '‚Äî' %></td>
              <td>
                <% if (page.tags && page.tags.length) { %>
                  <div class="tags-row">
                    <% page.tags.forEach(tag => { %>
                      <span class="tag"><%= tag %></span>
                    <% }) %>
                  </div>
                <% } else { %>
                  <span class="text-muted">Aucun</span>
                <% } %>
              </td>
              <td>
                <div class="trash-actions">
                  <form method="post" action="/admin/trash/<%= page.snowflake_id %>/restore" onsubmit="return confirm('Restaurer cette page ?');">
                    <button class="btn success" data-icon="‚ôªÔ∏è" type="submit">Restaurer</button>
                  </form>
                  <form method="post" action="/admin/trash/<%= page.snowflake_id %>/delete" onsubmit="return confirm('Supprimer d√©finitivement cette page ?');">
                    <button class="btn danger" data-icon="üóëÔ∏è" type="submit">Supprimer</button>
                  </form>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% if (pagination.totalPages > 1) { %>
      <%- include('./paginationControls', { pagination }) %>
    <% } %>
  <% } %>
</section>
