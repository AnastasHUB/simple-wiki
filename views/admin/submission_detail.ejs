<% title = 'Contribution'; %>
<h1>Contribution <code><%= submission.snowflake_id %></code></h1>

<section class="card mb-xl">
  <h2>Informations</h2>
  <div class="grid grid-auto">
    <div>
      <strong>Type</strong>
      <p><%= submission.type === 'edit' ? 'Modification' : 'Création' %></p>
    </div>
    <div>
      <strong>Titre proposé</strong>
      <p><strong><%= submission.title %></strong></p>
    </div>
    <div>
      <strong>IP</strong>
      <p><%= submission.ip || '–' %></p>
    </div>
    <div>
      <strong>Auteur proposé</strong>
      <% const submissionAuthorHandle = submission.author_name || submission.submitted_by; %>
      <% const submissionAuthorRole = submission.author_name ? submission.authorNameRole : submission.submittedByRole; %>
      <% if (submissionAuthorHandle) { %>
        <% const submissionAuthorColor = submissionAuthorRole && submissionAuthorRole.color ? submissionAuthorRole.color : null; %>
        <% const submissionAuthorClasses = ['user-handle', 'submission-author']; %>
        <% const submissionAuthorStyle = submissionAuthorColor && submissionAuthorColor.hasColor ? submissionAuthorColor.style : ''; %>
        <% if (submissionAuthorColor && submissionAuthorColor.hasColor) { submissionAuthorClasses.push('role-colored-text'); submissionAuthorClasses.push(submissionAuthorColor.className); } %>
        <p>
          <strong class="<%= submissionAuthorClasses.join(' ') %>" style="<%= submissionAuthorStyle %>">
            <%= submissionAuthorHandle %>
          </strong>
        </p>
      <% } else { %>
        <p>–</p>
      <% } %>
    </div>
    <div>
      <strong>Proposé le</strong>
      <p><%= new Date(submission.created_at).toLocaleString('fr-FR') %></p>
    </div>
    <div>
      <strong>Statut</strong>
      <p>
        <% if (submission.status === 'pending') { %>
          <span class="status status-pill pending">En attente</span>
        <% } else if (submission.status === 'approved') { %>
          <span class="status status-pill approved">Approuvée</span>
        <% } else { %>
          <span class="status status-pill rejected">Rejetée</span>
        <% } %>
      </p>
    </div>
    <% if (submission.reviewed_at) { %>
      <div>
        <strong>Décision</strong>
        <p>
          <%= new Date(submission.reviewed_at).toLocaleString('fr-FR') %>
          <% if (submission.reviewer_username) { %>
            <% const reviewerColor = submission.reviewerRole && submission.reviewerRole.color ? submission.reviewerRole.color : null; %>
            <% const reviewerClasses = ['user-handle', 'submission-reviewer']; %>
            <% const reviewerStyle = reviewerColor && reviewerColor.hasColor ? reviewerColor.style : ''; %>
            <% if (reviewerColor && reviewerColor.hasColor) { reviewerClasses.push('role-colored-text'); reviewerClasses.push(reviewerColor.className); } %>
            · par <strong class="<%= reviewerClasses.join(' ') %>" style="<%= reviewerStyle %>"><%= submission.reviewer_username %></strong>
          <% } %>
        </p>
      </div>
    <% } %>
    <% if (submission.review_note) { %>
      <div>
        <strong>Note</strong>
        <p><%= submission.review_note %></p>
      </div>
    <% } %>
    <div>
      <strong>Tags proposés</strong>
      <p>
        <% if (proposedTags.length) { %>
          <%= proposedTags.join(', ') %>
        <% } else { %>
          –
        <% } %>
      </p>
    </div>
    <% if (currentTags && currentTags.length) { %>
      <div>
        <strong>Tags actuels</strong>
        <p><%= currentTags.join(', ') %></p>
      </div>
    <% } %>
    <% if (submission.current_slug) { %>
      <div>
        <strong>Page actuelle</strong>
        <p><a href="/wiki/<%= submission.current_slug %>"><code><%= submission.current_slug %></code></a></p>
      </div>
    <% } %>
  </div>
</section>

<% if (submission.status === 'pending') { %>
  <section class="card mb-xl">
    <h2>Prendre une décision</h2>
    <div class="grid grid-auto">
      <form method="post" action="/admin/submissions/<%= submission.snowflake_id %>/approve" class="flex flex-col gap-sm">
        <%- include('../partials/csrf_field') %>
        <label for="approve-note">Note (optionnelle)</label>
        <textarea id="approve-note" name="note" rows="3" placeholder="Commentaire interne"></textarea>
        <button class="btn success" data-icon="✅" type="submit">Approuver la contribution</button>
      </form>
      <form method="post" action="/admin/submissions/<%= submission.snowflake_id %>/reject" class="flex flex-col gap-sm" onsubmit="return confirm('Rejeter cette contribution ?');">
        <%- include('../partials/csrf_field') %>
        <label for="reject-note">Motif (optionnel)</label>
        <textarea id="reject-note" name="note" rows="3" placeholder="Motif du rejet"></textarea>
        <button class="btn danger" data-icon="✖️" type="submit">Rejeter la contribution</button>
      </form>
    </div>
  </section>
<% } %>

<section class="card mb-xl">
  <h2>Contenu proposé</h2>
  <div class="prose"><div><%- proposedHtml %></div></div>
</section>

<% if (currentHtml) { %>
  <section class="card">
    <h2>Contenu actuel</h2>
    <div class="prose"><div><%- currentHtml %></div></div>
  </section>
<% } %>

