<% title = 'Contributions'; %>
<h1>Contributions des visiteurs</h1>

<section class="card mb-xl">
  <h2>En attente (<%= pendingPagination.totalItems %>)</h2>
  <% if (!pending.length) { %>
    <p>Aucune contribution en attente de validation.</p>
  <% } else { %>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Type</th>
            <th>Titre</th>
            <th>Page li√©e</th>
            <th>Tags</th>
            <th>IP</th>
            <th>Cr√©√©</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% pending.forEach(item => { %>
            <tr>
              <td><code><%= item.snowflake_id %></code></td>
              <td><%= item.type === 'edit' ? 'Modification' : 'Cr√©ation' %></td>
              <td><strong><%= item.title %></strong></td>
              <td>
                <% if (item.current_slug) { %>
                  <a href="/wiki/<%= item.current_slug %>"><code><%= item.current_slug %></code></a>
                <% } else { %>
                  ‚Äì
                <% } %>
              </td>
              <td>
                <% if (item.tag_list && item.tag_list.length) { %>
                  <%= item.tag_list.join(', ') %>
                <% } else { %>
                  ‚Äì
                <% } %>
              </td>
              <td><%= item.ip || '‚Äì' %></td>
              <td><%= new Date(item.created_at).toLocaleString('fr-FR') %></td>
              <td>
                <a class="btn" data-icon="üîç" href="/admin/submissions/<%= item.snowflake_id %>">Voir</a>
                <form method="post" action="/admin/submissions/<%= item.snowflake_id %>/approve">
                  <button class="btn success" data-icon="‚úÖ" type="submit">Approuver</button>
                </form>
                <form method="post" action="/admin/submissions/<%= item.snowflake_id %>/reject" onsubmit="return confirm('Rejeter cette contribution ?');">
                  <button class="btn danger" data-icon="‚úñÔ∏è" type="submit">Rejeter</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <%- include('./paginationControls', { pagination: pendingPagination }) %>
  <% } %>
</section>

<section class="card">
  <h2>Historique des d√©cisions (<%= recentPagination.totalItems %>)</h2>
  <% if (!recent.length) { %>
    <p>Aucune d√©cision enregistr√©e.</p>
  <% } else { %>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Type</th>
            <th>Titre</th>
            <th>Statut</th>
            <th>Valid√© par</th>
            <th>Revue</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>
          <% recent.forEach(item => { %>
            <tr>
              <td><code><%= item.snowflake_id %></code></td>
              <td><%= item.type === 'edit' ? 'Modification' : 'Cr√©ation' %></td>
              <td>
                <strong><%= item.title %></strong>
                <% if (item.result_slug_id) { %>
                  <div><a href="/wiki/<%= item.result_slug_id %>"><code><%= item.result_slug_id %></code></a></div>
                <% } %>
              </td>
              <td class="status <%= item.status %>"><%= item.status === 'approved' ? 'Approuv√©e' : 'Rejet√©e' %></td>
              <td><%= item.reviewer_username || '‚Äì' %></td>
              <td>
                <% if (item.reviewed_at) { %>
                  <%= new Date(item.reviewed_at).toLocaleString('fr-FR') %>
                <% } else { %>
                  ‚Äì
                <% } %>
              </td>
              <td><%= item.review_note ? item.review_note : '‚Äì' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <%- include('./paginationControls', { pagination: recentPagination }) %>
  <% } %>
</section>

