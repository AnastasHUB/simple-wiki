<% title='√âmojis & R√©actions'; %>
<h1>√âmojis & R√©actions</h1>
<p class="text-muted mb-md">
  Personnalisez la palette de r√©actions affich√©e sur les articles et les commentaires. Chaque r√©action
  doit poss√©der un identifiant unique ainsi qu'un emoji ou une image personnalis√©e.
</p>

<div class="card mb-md">
  <h2>Ajouter une r√©action</h2>
  <form method="post" action="/admin/reactions" class="flex flex-wrap gap-sm mt-sm">
    <%- include('../partials/csrf_field') %>
    <label class="stack-form flex-basis-200">
      <span class="text-sm text-muted">Identifiant</span>
      <input
        type="text"
        name="id"
        maxlength="48"
        required
        placeholder="ex. bravo-plus"
        aria-label="Identifiant unique"
      />
    </label>
    <label class="stack-form flex-basis-220">
      <span class="text-sm text-muted">Libell√©</span>
      <input
        type="text"
        name="label"
        maxlength="120"
        placeholder="Texte affich√©"
        aria-label="Libell√© de la r√©action"
      />
    </label>
    <label class="stack-form flex-basis-120">
      <span class="text-sm text-muted">Emoji</span>
      <input
        type="text"
        name="emoji"
        maxlength="16"
        placeholder="üòÄ"
        aria-label="Emoji"
      />
    </label>
    <label class="stack-form flex-basis-260">
      <span class="text-sm text-muted">URL d'image</span>
      <input
        type="url"
        name="imageUrl"
        maxlength="500"
        placeholder="https://‚Ä¶"
        aria-label="URL de l'image personnalis√©e"
      />
    </label>
    <div class="stack-form flex-basis-200">
      <span class="text-sm text-muted">&nbsp;</span>
      <button class="btn" data-icon="‚ûï" type="submit">Ajouter</button>
    </div>
    <p class="text-sm text-muted" style="flex-basis: 100%;">
      Fournissez au moins un emoji ou une image. Si les deux sont renseign√©s, l'image sera affich√©e.
    </p>
  </form>
</div>

<% if (!reactions || !reactions.length) { %>
  <div class="card">
    <p>Aucune r√©action n'est configur√©e pour le moment.</p>
  </div>
<% } else { %>
  <div class="stack-lg">
    <% reactions.forEach((reaction, index) => { %>
      <% const isFirst = index === 0; %>
      <% const isLast = index === reactions.length - 1; %>
      <article class="card admin-reaction-card">
        <div class="admin-reaction-top">
          <div class="admin-reaction-main">
            <span class="admin-reaction-preview" aria-hidden="true">
              <% if (reaction.imageUrl) { %>
                <img src="<%= reaction.imageUrl %>" alt="" loading="lazy" />
              <% } else { %>
                <%= reaction.emoji || 'üôÇ' %>
              <% } %>
            </span>
            <div class="admin-reaction-meta">
              <h2 class="admin-reaction-title"><%= reaction.label %></h2>
              <p class="text-sm text-muted">Identifiant¬†: <code><%= reaction.id %></code></p>
            </div>
          </div>
          <div class="admin-reaction-order">
            <form method="post" action="/admin/reactions/<%= reaction.id %>/move">
              <%- include('../partials/csrf_field') %>
              <input type="hidden" name="direction" value="up" />
              <button class="btn secondary" data-icon="‚¨ÜÔ∏è" type="submit" <%= isFirst ? 'disabled' : '' %>>Monter</button>
            </form>
            <form method="post" action="/admin/reactions/<%= reaction.id %>/move">
              <%- include('../partials/csrf_field') %>
              <input type="hidden" name="direction" value="down" />
              <button class="btn secondary" data-icon="‚¨áÔ∏è" type="submit" <%= isLast ? 'disabled' : '' %>>Descendre</button>
            </form>
          </div>
        </div>
        <form
          method="post"
          action="/admin/reactions/<%= reaction.id %>/update"
          class="admin-reaction-form"
        >
          <%- include('../partials/csrf_field') %>
          <div class="flex flex-wrap gap-sm">
            <label class="stack-form flex-basis-220">
              <span class="text-sm text-muted">Libell√©</span>
              <input
                type="text"
                name="label"
                maxlength="120"
                value="<%= reaction.label %>"
                aria-label="Libell√©"
              />
            </label>
            <label class="stack-form flex-basis-120">
              <span class="text-sm text-muted">Emoji</span>
              <input
                type="text"
                name="emoji"
                maxlength="16"
                value="<%= reaction.emoji %>"
                placeholder="üòÄ"
                aria-label="Emoji"
              />
            </label>
            <label class="stack-form flex-basis-260">
              <span class="text-sm text-muted">URL d'image</span>
              <input
                type="url"
                name="imageUrl"
                maxlength="500"
                value="<%= reaction.imageUrl || '' %>"
                placeholder="https://‚Ä¶"
                aria-label="URL de l'image"
              />
            </label>
          </div>
          <p class="text-sm text-muted mt-sm">
            Laissez l'emoji ou l'URL vide pour conserver la valeur actuelle. Au moins l'un des deux doit √™tre renseign√©.
          </p>
          <div class="flex flex-wrap gap-sm mt-sm">
            <button class="btn success" data-icon="üíæ" type="submit">Enregistrer</button>
          </div>
        </form>
        <form
          method="post"
          action="/admin/reactions/<%= reaction.id %>/delete"
          class="admin-reaction-delete"
          onsubmit="return confirm('Supprimer cette r√©action et toutes les r√©ponses associ√©es¬†?');"
        >
          <%- include('../partials/csrf_field') %>
          <button class="btn danger" data-icon="üóëÔ∏è" type="submit">Supprimer</button>
        </form>
      </article>
    <% }) %>
  </div>
<% } %>
