<% title = t('admin.reactions.title'); %>
<h1><%= t('admin.reactions.heading') %></h1>
<p class="text-muted mb-md">
  <%= t('admin.reactions.intro') %>
  </p>

<div class="card mb-md">
  <h2><%= t('admin.reactions.add.title') %></h2>
  <form method="post" action="/admin/reactions" class="flex flex-wrap gap-sm mt-sm">
    <%- include('../partials/csrf_field') %>
    <label class="stack-form flex-basis-200">
      <span class="text-sm text-muted"><%= t('admin.reactions.fields.id') %></span>
      <input
        type="text"
        name="id"
        maxlength="48"
        required
        placeholder="<%= t('admin.reactions.placeholders.id') %>"
        aria-label="<%= t('admin.reactions.aria.id') %>"
      />
    </label>
    <label class="stack-form flex-basis-220">
      <span class="text-sm text-muted"><%= t('admin.reactions.fields.label') %></span>
      <input
        type="text"
        name="label"
        maxlength="120"
        placeholder="<%= t('admin.reactions.placeholders.label') %>"
        aria-label="<%= t('admin.reactions.aria.label') %>"
      />
    </label>
    <label class="stack-form flex-basis-120">
      <span class="text-sm text-muted"><%= t('admin.reactions.fields.emoji') %></span>
      <input
        type="text"
        name="emoji"
        maxlength="16"
        placeholder="<%= t('admin.reactions.placeholders.emoji') %>"
        aria-label="<%= t('admin.reactions.aria.emoji') %>"
      />
    </label>
    <label class="stack-form flex-basis-260">
      <span class="text-sm text-muted"><%= t('admin.reactions.fields.imageUrl') %></span>
      <input
        type="url"
        name="imageUrl"
        maxlength="500"
        placeholder="<%= t('admin.reactions.placeholders.imageUrl') %>"
        aria-label="<%= t('admin.reactions.aria.imageUrl') %>"
      />
    </label>
    <div class="stack-form flex-basis-200">
      <span class="text-sm text-muted">&nbsp;</span>
      <button class="btn" type="submit"><%= t('admin.reactions.actions.add') %></button>
    </div>
    <%- include('../partials/uploadHelper') %>
    <p class="text-sm text-muted" style="flex-basis: 100%;">
      <%= t('admin.reactions.hints.provideOne') %>
    </p>
  </form>
  </div>

<% if (!reactions || !reactions.length) { %>
  <div class="card">
    <p><%= t('admin.reactions.empty') %></p>
  </div>
<% } else { %>
  <div class="stack-lg">
    <% reactions.forEach((reaction, index) => { %>
      <% const isFirst = index === 0; %>
      <% const isLast = index === reactions.length - 1; %>
      <article class="card admin-reaction-card">
        <div class="admin-reaction-top">
          <div class="admin-reaction-main">
            <span class="admin-reaction-preview" aria-hidden="true">
              <% if (reaction.imageUrl) { %>
                <img src="<%= reaction.imageUrl %>" alt="" loading="lazy" />
              <% } else { %>
                <%= reaction.emoji || 'ðŸ™‚' %>
              <% } %>
            </span>
            <div class="admin-reaction-meta">
              <h2 class="admin-reaction-title"><%= reaction.label %></h2>
              <p class="text-sm text-muted"><%= t('admin.reactions.item.identifier') %> <code><%= reaction.id %></code></p>
            </div>
          </div>
          <div class="admin-reaction-order">
            <form method="post" action="/admin/reactions/<%= reaction.id %>/move">
              <%- include('../partials/csrf_field') %>
              <input type="hidden" name="direction" value="up" />
              <button class="btn secondary" type="submit" <%= isFirst ? 'disabled' : '' %>><%= t('admin.reactions.item.moveUp') %></button>
            </form>
            <form method="post" action="/admin/reactions/<%= reaction.id %>/move">
              <%- include('../partials/csrf_field') %>
              <input type="hidden" name="direction" value="down" />
              <button class="btn secondary" type="submit" <%= isLast ? 'disabled' : '' %>><%= t('admin.reactions.item.moveDown') %></button>
            </form>
          </div>
        </div>
        <form
          method="post"
          action="/admin/reactions/<%= reaction.id %>/update"
          class="admin-reaction-form"
        >
          <%- include('../partials/csrf_field') %>
          <div class="flex flex-wrap gap-sm">
            <label class="stack-form flex-basis-220">
              <span class="text-sm text-muted"><%= t('admin.reactions.fields.label') %></span>
              <input
                type="text"
                name="label"
                maxlength="120"
                value="<%= reaction.label %>"
                aria-label="<%= t('admin.reactions.aria.label') %>"
              />
            </label>
            <label class="stack-form flex-basis-120">
              <span class="text-sm text-muted"><%= t('admin.reactions.fields.emoji') %></span>
              <input
                type="text"
                name="emoji"
                maxlength="16"
                value="<%= reaction.emoji %>"
                placeholder="<%= t('admin.reactions.placeholders.emoji') %>"
                aria-label="<%= t('admin.reactions.aria.emoji') %>"
              />
            </label>
            <label class="stack-form flex-basis-260">
              <span class="text-sm text-muted"><%= t('admin.reactions.fields.imageUrl') %></span>
              <input
                type="url"
                name="imageUrl"
                maxlength="500"
                value="<%= reaction.imageUrl || '' %>"
                placeholder="<%= t('admin.reactions.placeholders.imageUrl') %>"
                aria-label="<%= t('admin.reactions.aria.imageUrl') %>"
              />
            </label>
          </div>
          <%- include('../partials/uploadHelper') %>
          <p class="text-sm text-muted mt-sm">
            <%= t('admin.reactions.hints.keepOrBlank') %>
          </p>
          <div class="flex flex-wrap gap-sm mt-sm">
            <button class="btn success" type="submit"><%= t('admin.reactions.actions.save') %></button>
          </div>
        </form>
        <form
          method="post"
          action="/admin/reactions/<%= reaction.id %>/delete"
          class="admin-reaction-delete"
          onsubmit="return confirm(t('admin.reactions.actions.deleteConfirm'))"
        >
          <%- include('../partials/csrf_field') %>
          <button class="btn danger" type="submit"><%= t('admin.reactions.actions.delete') %></button>
        </form>
      </article>
    <% }) %>
  </div>
<% } %>

