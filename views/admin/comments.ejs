<h1>Mod√©ration des commentaires</h1>

<section class="card" style="margin-bottom:24px;">
  <h2 style="margin-top:0;">En attente de validation (<%= pendingPagination.totalItems %>)</h2>
  <% if (!pending.length) { %>
    <p>Aucun commentaire en attente.</p>
  <% } else { %>
    <ul class="admin-comment-list">
      <% pending.forEach(c => { %>
        <li>
          <header>
            <div>
              <strong><%= c.author || 'Anonyme' %></strong>
              <span>¬∑ <%= new Date(c.created_at).toLocaleString('fr-FR') %></span>
            </div>
            <a class="tag" href="/wiki/<%= c.page_slug %>" target="_blank" rel="noopener">Voir la page</a>
          </header>
          <p><%= c.body %></p>
          <p class="meta">IP: <code><%= c.ip || 'n/a' %></code></p>
          <% if (c.updated_at) { %>
            <p class="meta">Derni√®re modification : <%= new Date(c.updated_at).toLocaleString('fr-FR') %></p>
          <% } %>
          <div class="actions">
            <form method="post" action="/admin/comments/<%= c.snowflake_id %>/approve">
              <button class="btn success" data-icon="‚úÖ" type="submit">Approuver</button>
            </form>
            <form method="post" action="/admin/comments/<%= c.snowflake_id %>/reject">
              <button class="btn" data-icon="üö´" type="submit">Rejeter</button>
            </form>
            <form method="post" action="/admin/comments/<%= c.snowflake_id %>/delete" onsubmit="return confirm('Supprimer ce commentaire ?');">
              <button class="btn unlike" data-icon="üóëÔ∏è" type="submit">Supprimer</button>
            </form>
          </div>
        </li>
      <% }) %>
    </ul>
    <div class="table-footer" style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.75rem; margin-top:1rem;">
      <form method="get" style="display:flex; align-items:center; gap:0.5rem;">
        <label for="pending-per-page" style="white-space:nowrap;">√âl√©ments par page</label>
        <select id="pending-per-page" name="pendingPerPage" onchange="this.form.submit()">
          <% pendingPagination.perPageOptions.forEach(option => { %>
            <option value="<%= option %>" <%= option === pendingPagination.perPage ? 'selected' : '' %>><%= option %></option>
          <% }) %>
        </select>
        <input type="hidden" name="pendingPage" value="1">
        <input type="hidden" name="recentPage" value="<%= recentPagination.page %>">
        <input type="hidden" name="recentPerPage" value="<%= recentPagination.perPage %>">
      </form>
      <span>Page <%= pendingPagination.page %> sur <%= pendingPagination.totalPages %></span>
      <div style="display:flex; gap:0.5rem;">
        <% if (pendingPagination.hasPrevious) { %>
          <a class="btn" data-icon="‚¨ÖÔ∏è" href="?pendingPage=<%= pendingPagination.previousPage %>&pendingPerPage=<%= pendingPagination.perPage %>&recentPage=<%= recentPagination.page %>&recentPerPage=<%= recentPagination.perPage %>">Pr√©c√©dent</a>
        <% } else { %>
          <span class="btn" data-icon="‚¨ÖÔ∏è" aria-disabled="true" style="pointer-events:none; opacity:0.5;">Pr√©c√©dent</span>
        <% } %>
        <% if (pendingPagination.hasNext) { %>
          <a class="btn" data-icon="‚û°Ô∏è" href="?pendingPage=<%= pendingPagination.nextPage %>&pendingPerPage=<%= pendingPagination.perPage %>&recentPage=<%= recentPagination.page %>&recentPerPage=<%= recentPagination.perPage %>">Suivant</a>
        <% } else { %>
          <span class="btn" data-icon="‚û°Ô∏è" aria-disabled="true" style="pointer-events:none; opacity:0.5;">Suivant</span>
        <% } %>
      </div>
    </div>
  <% } %>
</section>

<section class="card">
  <h2 style="margin-top:0;">Historique r√©cent</h2>
  <% if (!recent.length) { %>
    <p>Aucun commentaire mod√©r√© pour le moment.</p>
  <% } else { %>
    <ul class="admin-comment-list compact">
      <% recent.forEach(c => { %>
        <li>
          <header>
            <div>
              <strong><%= c.author || 'Anonyme' %></strong>
              <span>¬∑ <%= new Date(c.created_at).toLocaleString('fr-FR') %> ¬∑ <span class="status <%= c.status %>"><%= c.status %></span></span>
            </div>
            <a class="tag" href="/wiki/<%= c.page_slug %>" target="_blank" rel="noopener">Voir la page</a>
          </header>
          <p><%= c.body %></p>
          <p class="meta">IP: <code><%= c.ip || 'n/a' %></code></p>
          <% if (c.updated_at) { %>
            <p class="meta">Derni√®re modification : <%= new Date(c.updated_at).toLocaleString('fr-FR') %></p>
          <% } %>
          <div class="actions">
            <form method="post" action="/admin/comments/<%= c.snowflake_id %>/delete" onsubmit="return confirm('Supprimer ce commentaire ?');">
              <button class="btn unlike" data-icon="üóëÔ∏è" type="submit">Supprimer</button>
            </form>
          </div>
        </li>
      <% }) %>
    </ul>
    <div class="table-footer" style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.75rem; margin-top:1rem;">
      <form method="get" style="display:flex; align-items:center; gap:0.5rem;">
        <label for="recent-per-page" style="white-space:nowrap;">√âl√©ments par page</label>
        <select id="recent-per-page" name="recentPerPage" onchange="this.form.submit()">
          <% recentPagination.perPageOptions.forEach(option => { %>
            <option value="<%= option %>" <%= option === recentPagination.perPage ? 'selected' : '' %>><%= option %></option>
          <% }) %>
        </select>
        <input type="hidden" name="recentPage" value="1">
        <input type="hidden" name="pendingPage" value="<%= pendingPagination.page %>">
        <input type="hidden" name="pendingPerPage" value="<%= pendingPagination.perPage %>">
      </form>
      <span>Page <%= recentPagination.page %> sur <%= recentPagination.totalPages %></span>
      <div style="display:flex; gap:0.5rem;">
        <% if (recentPagination.hasPrevious) { %>
          <a class="btn" data-icon="‚¨ÖÔ∏è" href="?recentPage=<%= recentPagination.previousPage %>&recentPerPage=<%= recentPagination.perPage %>&pendingPage=<%= pendingPagination.page %>&pendingPerPage=<%= pendingPagination.perPage %>">Pr√©c√©dent</a>
        <% } else { %>
          <span class="btn" data-icon="‚¨ÖÔ∏è" aria-disabled="true" style="pointer-events:none; opacity:0.5;">Pr√©c√©dent</span>
        <% } %>
        <% if (recentPagination.hasNext) { %>
          <a class="btn" data-icon="‚û°Ô∏è" href="?recentPage=<%= recentPagination.nextPage %>&recentPerPage=<%= recentPagination.perPage %>&pendingPage=<%= pendingPagination.page %>&pendingPerPage=<%= pendingPagination.perPage %>">Suivant</a>
        <% } else { %>
          <span class="btn" data-icon="‚û°Ô∏è" aria-disabled="true" style="pointer-events:none; opacity:0.5;">Suivant</span>
        <% } %>
      </div>
    </div>
  <% } %>
</section>
