<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= typeof title!== 'undefined' ? title + ' · ' : '' %><%= wikiName %></title>
  <link rel="stylesheet" href="/public/style.css" />
</head>
<body>
<header class="topbar">
  <button class="btn icon only" id="sidebarToggle" aria-label="Menu">☰</button>
  <form method="get" action="/search" class="searchbar">
    <input type="text" name="q" placeholder="Rechercher…">
    <button class="btn search">Rechercher</button>
  </form>
  <div class="auth">
    <% if (user) { %>
      <div class="who">Connecté: <strong><%= user.username %></strong></div>
      <form action="/logout" method="post"><button class="btn">Déconnexion</button></form>
    <% } else { %>
      <a class="btn" href="/login">Connexion</a>
    <% } %>
  </div>
</header>

<div class="shell">
  <!-- Sidebar AVANT overlay -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <% if (logoUrl) { %><img src="<%= logoUrl %>" alt="logo"><% } %>
      <div class="brand-name"><%= wikiName %></div>
    </div>
    <nav class="vnav" id="vnav">
      <a href="/">🏠 Accueil</a>
      <a href="/rss.xml">📰 Flux RSS</a>
      <% if (user && user.is_admin) { %>
        <a href="/new">➕ Nouvelle page</a>
        <a href="/admin/users">👤 Utilisateurs</a>
        <a href="/admin/likes">❤️ Likes</a>
        <a href="/admin/settings">⚙️ Paramètres</a>
      <% } %>
    </nav>
  </aside>

  <!-- Overlay APRES sidebar -->
  <div class="drawer-overlay" id="drawerOverlay"></div>

  <main class="content"><%- body %></main>
</div>

<footer class="site-footer"><small><%- footerText %></small></footer>

<script defer src="/public/app.js"></script>
</body>
</html>
