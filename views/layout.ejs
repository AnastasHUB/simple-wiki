<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <% const metaTags = (typeof meta !== 'undefined' && meta) || {}; %>
  <title>
    <%= typeof title !== 'undefined' ? title + ' · ' : '' %><%= typeof wikiName !== 'undefined' ? wikiName : 'Wiki' %>
  </title>
  <% if (metaTags.description) { %>
    <meta name="description" content="<%= metaTags.description %>" />
  <% } %>
  <% const canonicalUrl = metaTags.canonical || metaTags.url; %>
  <% if (canonicalUrl) { %>
    <link rel="canonical" href="<%= canonicalUrl %>" />
  <% } %>
  <% if (metaTags.title) { %>
    <meta property="og:title" content="<%= metaTags.title %>" />
    <meta name="twitter:title" content="<%= metaTags.title %>" />
  <% } %>
  <% if (metaTags.description) { %>
    <meta property="og:description" content="<%= metaTags.description %>" />
    <meta name="twitter:description" content="<%= metaTags.description %>" />
  <% } %>
  <% if (metaTags.siteName) { %>
    <meta property="og:site_name" content="<%= metaTags.siteName %>" />
  <% } %>
  <% if (metaTags.url) { %>
    <meta property="og:url" content="<%= metaTags.url %>" />
  <% } %>
  <% if (metaTags.type) { %>
    <meta property="og:type" content="<%= metaTags.type %>" />
  <% } %>
  <% if (metaTags.image) { %>
    <meta property="og:image" content="<%= metaTags.image %>" />
    <meta name="twitter:image" content="<%= metaTags.image %>" />
  <% } %>
  <% if (metaTags.imageAlt) { %>
    <meta property="og:image:alt" content="<%= metaTags.imageAlt %>" />
    <meta name="twitter:image:alt" content="<%= metaTags.imageAlt %>" />
  <% } %>
  <% if (metaTags.publishedTime) { %>
    <meta property="article:published_time" content="<%= metaTags.publishedTime %>" />
  <% } %>
  <% if (metaTags.modifiedTime) { %>
    <meta property="article:modified_time" content="<%= metaTags.modifiedTime %>" />
  <% } %>
  <% if (Array.isArray(metaTags.tags)) { %>
    <% metaTags.tags.forEach(tagName => { %>
      <meta property="article:tag" content="<%= tagName %>" />
    <% }) %>
  <% } %>
  <meta name="twitter:card" content="<%= metaTags.twitterCard || 'summary' %>" />
  <link rel="stylesheet" href="/public/style.css" />
  <link rel="stylesheet" href="https://cdn.quilljs.com/1.3.7/quill.snow.css" />
</head>
<body>
<% const currentUser = typeof user !== 'undefined' && user ? user : null; %>
<% const hasBrandLogo = typeof logoUrl !== 'undefined' && logoUrl; %>
<% const adminCounts = typeof adminActionCounts !== 'undefined' ? adminActionCounts : {}; %>
<header class="site-header">
  <div class="brand">
    <a class="brand-link" href="/">
      <% if (hasBrandLogo) { %>
        <img src="<%= logoUrl %>" alt="Logo de <%= typeof wikiName !== 'undefined' ? wikiName : 'Wiki' %>" />
      <% } %>
      <span><%= typeof wikiName !== 'undefined' ? wikiName : 'Wiki' %></span>
    </a>
  </div>
  <form method="get" action="/search" class="search-form" role="search">
    <label class="sr-only" for="wikiSearch">Rechercher</label>
    <input id="wikiSearch" type="text" name="q" placeholder="Rechercher…" aria-label="Rechercher sur le wiki">
    <button class="btn" type="submit">Rechercher</button>
  </form>
  <div class="auth-links">
    <% if (currentUser) { %>
      <span>Connecté·e : <strong><%= currentUser.display_name || currentUser.username %></strong></span>
      <form action="/logout" method="post">
        <button class="btn" type="submit">Déconnexion</button>
      </form>
    <% } else { %>
      <a class="btn" href="/login">Connexion</a>
    <% } %>
  </div>
</header>

<nav class="site-nav" aria-label="Navigation principale">
  <ul>
    <li><a href="/">Accueil</a></li>
    <li><a href="/rss.xml" target="_blank" rel="noopener">Flux RSS</a></li>
    <% if (typeof canViewIpProfile !== 'undefined' && canViewIpProfile) { %>
      <li><a href="/profiles/ip/me">Mon profil IP</a></li>
    <% } %>
    <% if (!currentUser || !currentUser.is_admin) { %>
      <li><a href="/new">Contribuer</a></li>
    <% } %>
    <li><a href="/account/submissions">Mes contributions</a></li>
    <% if (currentUser && currentUser.is_admin) { %>
      <li><a href="/new">Nouvelle page</a></li>
      <li>
        <a href="/admin/submissions">
          Contributions<% if (adminCounts.pendingSubmissions) { %> (<%= adminCounts.pendingSubmissions %>)<% } %>
        </a>
      </li>
      <li><a href="/admin/pages">Articles</a></li>
      <li><a href="/admin/trash">Corbeille</a></li>
      <li><a href="/admin/stats">Statistiques</a></li>
      <li><a href="/admin/users">Utilisateurs</a></li>
      <li>
        <a href="/admin/comments">
          Commentaires<% if (adminCounts.pendingComments) { %> (<%= adminCounts.pendingComments %>)<% } %>
        </a>
      </li>
      <li><a href="/admin/likes">Likes</a></li>
      <li>
        <a href="/admin/ip-bans">Blocages IP</a>
      </li>
      <li>
        <a href="/admin/ip-reputation">
          Surveillance IP<% if (adminCounts.suspiciousIps) { %> (<%= adminCounts.suspiciousIps %>)<% } %>
        </a>
      </li>
      <li><a href="/admin/ip-profiles">Profils IP</a></li>
      <li>
        <a href="/admin/ban-appeals">
          Demandes de déban<% if (adminCounts.pendingBanAppeals) { %> (<%= adminCounts.pendingBanAppeals %>)<% } %>
        </a>
      </li>
      <li><a href="/admin/snowflakes">Snowflakes</a></li>
      <li><a href="/admin/events">Événements</a></li>
      <li><a href="/admin/uploads">Images</a></li>
      <li><a href="/admin/settings">Paramètres</a></li>
    <% } %>
  </ul>
</nav>

<% const initialNotifications = typeof notifications !== 'undefined' ? notifications : []; %>
<div class="notification-layer" id="notificationLayer"></div>
<main class="page-content"><%- body %></main>
<footer class="site-footer"><small><%- typeof footerText !== 'undefined' ? footerText : '' %></small></footer>

<script type="application/json" id="initial-notifications"><%- JSON.stringify(initialNotifications).replace(/</g, '\\u003c') %></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script defer src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script defer src="/public/app.js"></script>
</body>
</html>
