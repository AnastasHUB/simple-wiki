<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <% const metaTags = (typeof meta !== 'undefined' && meta) || {}; %>
  <title>
    <%= typeof title !== 'undefined' ? title + ' · ' : '' %><%= typeof wikiName !== 'undefined' ? wikiName : 'Wiki' %>
  </title>
  <% if (metaTags.description) { %>
    <meta name="description" content="<%= metaTags.description %>" />
  <% } %>
  <% const canonicalUrl = metaTags.canonical || metaTags.url; %>
  <% if (canonicalUrl) { %>
    <link rel="canonical" href="<%= canonicalUrl %>" />
  <% } %>
  <% if (metaTags.title) { %>
    <meta property="og:title" content="<%= metaTags.title %>" />
    <meta name="twitter:title" content="<%= metaTags.title %>" />
  <% } %>
  <% if (metaTags.description) { %>
    <meta property="og:description" content="<%= metaTags.description %>" />
    <meta name="twitter:description" content="<%= metaTags.description %>" />
  <% } %>
  <% if (metaTags.siteName) { %>
    <meta property="og:site_name" content="<%= metaTags.siteName %>" />
  <% } %>
  <% if (metaTags.url) { %>
    <meta property="og:url" content="<%= metaTags.url %>" />
  <% } %>
  <% if (metaTags.type) { %>
    <meta property="og:type" content="<%= metaTags.type %>" />
  <% } %>
  <% if (metaTags.image) { %>
    <meta property="og:image" content="<%= metaTags.image %>" />
    <meta name="twitter:image" content="<%= metaTags.image %>" />
  <% } %>
  <% if (metaTags.imageAlt) { %>
    <meta property="og:image:alt" content="<%= metaTags.imageAlt %>" />
    <meta name="twitter:image:alt" content="<%= metaTags.imageAlt %>" />
  <% } %>
  <% if (metaTags.publishedTime) { %>
    <meta property="article:published_time" content="<%= metaTags.publishedTime %>" />
  <% } %>
  <% if (metaTags.modifiedTime) { %>
    <meta property="article:modified_time" content="<%= metaTags.modifiedTime %>" />
  <% } %>
  <% if (Array.isArray(metaTags.tags)) { %>
    <% metaTags.tags.forEach(tagName => { %>
      <meta property="article:tag" content="<%= tagName %>" />
    <% }) %>
  <% } %>
  <meta name="twitter:card" content="<%= metaTags.twitterCard || 'summary' %>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/public/style.css" />
  <link rel="stylesheet" href="https://cdn.quilljs.com/1.3.7/quill.snow.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
  />
</head>
<body>
<% const currentUser = typeof user !== 'undefined' && user ? user : null; %>
<% const hasBrandLogo = typeof logoUrl !== 'undefined' && logoUrl; %>
<header class="topbar" data-glass="surface">
  <div class="topbar-left">
    <button class="btn icon only topbar-toggle" id="sidebarToggle" type="button" aria-label="Ouvrir la navigation">
      <span class="material-symbols-rounded" aria-hidden="true">menu</span>
    </button>
    <a class="brand-link" href="/">
      <% if (hasBrandLogo) { %>
        <span class="brand-logo"><img src="<%= logoUrl %>" alt="Logo de <%= typeof wikiName !== 'undefined' ? wikiName : 'Wiki' %>"></span>
      <% } else { %>
        <span class="brand-logo generated" aria-hidden="true"><span class="material-symbols-rounded">explore</span></span>
      <% } %>
      <span class="brand-name"><%= typeof wikiName !== 'undefined' ? wikiName : 'Wiki' %></span>
    </a>
  </div>
  <form method="get" action="/search" class="searchbar" role="search">
    <label class="sr-only" for="global-search">Rechercher sur le wiki</label>
    <input id="global-search" type="text" name="q" placeholder="Rechercher…" aria-label="Rechercher" />
    <button class="btn icon only" type="submit" aria-label="Lancer la recherche">
      <span class="material-symbols-rounded" aria-hidden="true">search</span>
    </button>
  </form>
  <div class="auth">
    <% if (currentUser) { %>
      <div class="who" aria-live="polite">
        <span class="material-symbols-rounded" aria-hidden="true">person</span>
        <span><strong><%= currentUser.display_name || currentUser.username %></strong></span>
      </div>
      <form action="/logout" method="post">
        <button class="btn ghost" data-icon="mat:logout">Déconnexion</button>
      </form>
    <% } else { %>
      <a class="btn primary" data-icon="mat:login" href="/login">Connexion</a>
    <% } %>
  </div>
</header>

<div class="shell">
  <aside class="sidebar" id="sidebar" aria-label="Menu principal" data-glass="panel">
    <div class="sidebar-header">
      <% if (hasBrandLogo) { %>
        <img src="<%= logoUrl %>" alt="Logo de <%= typeof wikiName !== 'undefined' ? wikiName : 'Wiki' %>" />
      <% } else { %>
        <span class="material-symbols-rounded" aria-hidden="true">layers</span>
      <% } %>
      <div>
        <p class="sidebar-subtitle">Tableau de bord</p>
        <p class="sidebar-title"><%= typeof wikiName !== 'undefined' ? wikiName : 'Wiki' %></p>
      </div>
    </div>
    <nav class="vnav" id="vnav">
      <a href="/" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">home</span><span>Accueil</span></a>
      <a href="/rss.xml" target="_blank" rel="noopener" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">rss_feed</span><span>Flux RSS</span></a>
      <% if (typeof canViewIpProfile !== 'undefined' && canViewIpProfile) { %>
        <a href="/profiles/ip/me" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">badge</span><span>Mon profil IP</span></a>
      <% } %>
      <% if (!currentUser || !currentUser.is_admin) { %>
        <a href="/new" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">edit</span><span>Contribuer</span></a>
      <% } %>
      <a href="/account/submissions" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">folder</span><span>Mes contributions</span></a>
      <% if (currentUser && currentUser.is_admin) { %>
        <% const adminCounts = typeof adminActionCounts !== 'undefined' ? adminActionCounts : {}; %>
        <p class="nav-section">Administration</p>
        <a href="/new" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">note_add</span><span>Nouvelle page</span></a>
        <a href="/admin/submissions" class="nav-item nav-item--with-badge">
          <span class="material-symbols-rounded" aria-hidden="true">move_to_inbox</span>
          <span>Contributions</span>
          <% if (adminCounts.pendingSubmissions) { %>
            <span class="nav-badge" aria-label="Propositions à examiner"><%= adminCounts.pendingSubmissions %></span>
          <% } %>
        </a>
        <a href="/admin/pages" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">article</span><span>Articles</span></a>
        <a href="/admin/trash" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">delete</span><span>Corbeille</span></a>
        <a href="/admin/stats" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">insights</span><span>Statistiques</span></a>
        <a href="/admin/users" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">group</span><span>Utilisateurs</span></a>
        <a href="/admin/comments" class="nav-item nav-item--with-badge">
          <span class="material-symbols-rounded" aria-hidden="true">chat</span>
          <span>Commentaires</span>
          <% if (adminCounts.pendingComments) { %>
            <span class="nav-badge" aria-label="Commentaires en attente"><%= adminCounts.pendingComments %></span>
          <% } %>
        </a>
        <a href="/admin/likes" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">favorite</span><span>Likes</span></a>
        <a href="/admin/ip-bans" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">block</span><span>Blocages IP</span></a>
        <a href="/admin/ip-reputation" class="nav-item nav-item--with-badge">
          <span class="material-symbols-rounded" aria-hidden="true">shield</span>
          <span>Surveillance IP</span>
          <% if (adminCounts.suspiciousIps) { %>
            <span class="nav-badge" aria-label="IP suspectes"><%= adminCounts.suspiciousIps %></span>
          <% } %>
        </a>
        <a href="/admin/ip-profiles" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">description</span><span>Profils IP</span></a>
        <a href="/admin/ban-appeals" class="nav-item nav-item--with-badge">
          <span class="material-symbols-rounded" aria-hidden="true">mail</span>
          <span>Demandes de déban</span>
          <% if (adminCounts.pendingBanAppeals) { %>
            <span class="nav-badge" aria-label="Demandes de déban en attente"><%= adminCounts.pendingBanAppeals %></span>
          <% } %>
        </a>
        <a href="/admin/events" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">event_note</span><span>Événements</span></a>
        <a href="/admin/uploads" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">image</span><span>Images</span></a>
        <a href="/admin/settings" class="nav-item"><span class="material-symbols-rounded" aria-hidden="true">settings</span><span>Paramètres</span></a>
      <% } %>
    </nav>
  </aside>

  <div class="drawer-overlay" id="drawerOverlay" aria-hidden="true"></div>

  <% const initialNotifications = typeof notifications !== 'undefined' ? notifications : []; %>
  <div class="notification-layer" id="notificationLayer" role="status" aria-live="polite"></div>
  <main class="content" id="mainContent"><%- body %></main>
</div>

<footer class="site-footer">
  <small><%- typeof footerText !== 'undefined' ? footerText : '' %></small>
</footer>

<script type="application/json" id="initial-notifications"><%- JSON.stringify(initialNotifications).replace(/</g, '\\u003c') %></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script defer src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script defer src="/public/app.js"></script>
</body>
</html>
